---
title: Models without compartments ($PRED)
author: ~
date: '2018-09-03'
slug: models-without-compartments-pred
categories: []
tags: ["PRED", "in-development"]
---


# Introduction
This post introduces a new formal code block for writing models
where there are no compartments.  The block is named after the 
analgous NONMEM block called `$PRED`.  This functionality 
has always been possible with mrgsolve, but only now is there a 
code block dedicated to these models. Also, a relaxed set of 
data set constraints have been put in place when these types of 
models are invoked. 

# Status
The functionality in this vignette can only be access from the 
GitHub version.  We will update this vignette once these features
are rolled into a release on CRAN.

# Example model

As a most-basic model, we look at the `pred1` model in `modlib()`

```{r}
library(mrgsolve)
mod <- mread("pred1", modlib())
```


The model code is
```{c, eval = FALSE,code = mod@code}

```


This is a random-intercept, random slope linear model.  Like other 
models in mrgsolve, you can write parameters (`$PARAM`), and 
random effects (`$OMEGA`).  But the model is actually written in `$PRED`.  

When mrgsolve finds `$PRED`, it will generate an error if it also finds
`$MAIN`, `$TABLE`, or `$ODE`.  However, the code that gets entered into
`$PRED` would function exactly as if you put it in `$TABLE`.

In the example model, the response is a function of the parameter `B`, 
so we'll generate an input data set with some values of `B`

```{r,message = FALSE}
library(dplyr)
data <- data_frame(ID = 1, B = exp(rnorm(100, 0,2)))

head(data)
```

```{r}
out <- mrgsim_d(mod,data,carry.out="B")

plot(out, Y~B)
```


Like other models, we can simulate from a population

```{r}
library(purrr)
set.seed(223)
df <- map_df(1:30, function(i) data_frame(ID = i, B = seq(0,30,1)))

head(df)

mod %>% 
  data_set(df) %>% 
  mrgsim(carry.out="B") %>%
  plot(Y ~ B)
```


